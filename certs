#!/bin/sh
p4 login > /dev/null
p4 -c pvzcards_certs sync -f //... > /dev/null
pushd ~/pvzcards_certs > /dev/null

#install provisions
mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
for file in *.*provision*; do
    uuid=`grep UUID -A1 -a "$file" | grep -io "[-A-Z0-9]\{36\}"`
    extension="${file##*.}"
    cp -f "$file" ~/Library/MobileDevice/Provisioning\ Profiles/"$uuid.$extension"
done

#install certs
security unlock-keychain login.keychain
security import ./ROW_Development.p12 -k login.keychain -P jamdat1
security import ./iOS_Dev_Certificates.p12 -k login.keychain -P WWGFD

popd
p4 -c pvzcards_certs sync -f //...@0 > /dev/null
rm -r ~/pvzcards_certs
p4 logout /dev/null
